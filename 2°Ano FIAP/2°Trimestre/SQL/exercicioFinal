create database sistemaDeGestao

use sistemaDeGestao

create table proprietarios(
proprietarioid int primary key,
nome varchar(100) not null,
telefone varchar(20)
)

create table imoveis(
imovelid int primary key,
endereço varchar(150) not null,
tipo varchar(50) not null,
valorAluguel decimal(10,2) not null,
proprietarioid int,
foreign key (proprietarioid) references proprietarios(proprietarioid)
)

create table clientes(
clienteid int primary key,
nome varchar(100) not null,
cpf varchar(14) unique not null,
telefone varchar(20) not null
)

create table contratos(
contratoid int primary key,
imovelid int not null,
clienteid int not null,
dataInicio date not null,
dataFim date not null,
valorMensal decimal(10,2)not null,
statusContratos varchar(20) not null,
foreign key (imovelid) references imoveis(imovelid),
foreign key (clienteid) references clientes(clienteid)
)

create table logEncerramentos(
logid int primary key identity(1,1),
contratoid int,
dataEncerramento date not null,
dataRegistro date default getdate() not null,
foreign key (contratoid) references contratos(contratoid)
)

insert into proprietarios(proprietarioid,nome,telefone) values
(1,'Diogo',1),
(2,'Alvoro',2);

insert into imoveis (imovelid,endereço,tipo,valorAluguel,proprietarioid) values
(1,'rua1','Casa',1000,1),
(2,'rua2','Apartamento',1500,2),
(3,'rua3','Comercial',1200,3),
(4,'rua4','Apartamento',2000,4)

insert into clientes (clienteid,nome,cpf,telefone) values
(1,'Mauricio',1,3),
(2,'Enzo',2,4),
(3,'Gabis',3,5);

insert into contratos (contratoid,imovelid,clienteid,dataInicio,dataFim,valorMensal,statusContratos) values
(1,1,1,'05-08-2024','05-08-2026',1000,'Ativo'),
(2,2,2,'12-25-2020','12-25-2023',1500,'Encerrado'),
(3,3,1,'05-02-2025','05-02-2028',1200,'Ativo');

create procedure sp_clienteComMaisDeUmContrato
